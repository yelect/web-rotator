<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Electra Map Rotator – No External JS</title>

  <!-- 1. Early connections -->
  <link rel="dns-prefetch" href="https://backend.go-electra.com">
  <link rel="preconnect" href="https://backend.go-electra.com" crossorigin>

  <!-- 2. Preload the map HTML document -->
  <link rel="preload"
        href="https://backend.go-electra.com/tv/map?loc=alpine&token=dd0417ad0ab021cc37716848ba0b44e"
        as="document">

  <!-- 3. Preload static bundles (update with actual names from DevTools) -->
  <link rel="preload"
        href="https://backend.go-electra.com/packs/js/904-11acb475713a3c354b63.js"
        as="script">
  <link rel="preload"
        href="https://backend.go-electra.com/packs/js/tv-43ca84669d193ff95164.js"
        as="script">

  <style>
    html, body {
      margin: 0;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    button {
      font-size: 2em;
      padding: 1em 2em;
    }
    .preload {
      width: 1px;
      height: 1px;
      border: none;
      position: absolute;
      left: -9999px;
    }
  </style>
</head>
<body>

  <button id="start">Start Rotator</button>

  <!-- Hidden iframes to keep the map runtime and tiles warm -->
  <div id="map-preloads">
    <iframe class="preload"
            src="https://backend.go-electra.com/tv/map?loc=alpine&token=dd0417ad0ab021cc37716848ba0b44e"
            aria-hidden="true"></iframe>
    <iframe class="preload"
            src="https://backend.go-electra.com/tv/map?loc=alpine&token=dd0417ad0ab021cc37716848ba0b44e"
            aria-hidden="true"></iframe>
    <iframe class="preload"
            src="https://backend.go-electra.com/tv/map?loc=alpine&token=dd0417ad0ab021cc37716848ba0b44e"
            aria-hidden="true"></iframe>
  </div>

  <script>
    (function(){
      // --- UNCHANGED: All your URLs and config except below ---
      const mapUrl = 'https://backend.go-electra.com/tv/map?loc=alpine&token=dd0417ad0ab021cc37716848ba0b44e';
      const tikeeUrl = 'https://my.tikee.io/galleries/7a087048-6b5a-4cba-ae1e-0d1de46defe4/gallery/private_share/76685442-dec4-4c18-ab1b-5597247aa308';

      // Order is preserved. Map shows twice as long (as before).
      const sites = [
        tikeeUrl,
        'https://docs.google.com/presentation/d/e/2PACX-1vRbkf5uiF8hV0MDI3vxdCelaiIRFaWLWTzH91U0Sls2ydZ84zr---I47v1GYfKdUzOg-tluTfDD-VYH/pub?start=true&loop=true&delayms=30000',
        mapUrl,
        'https://www.google.com/maps/d/u/0/embed?mid=1fG8w2nxBmiQkhlgSxykH8RwQMaeBVb0&ehbc=2E312F&ll=46.840997703251794%2C8.190445841796858&z=8',
        'https://docs.google.com/presentation/d/e/2PACX-1vRjOAXI4N27Lud4-HxzPdFbZh5U9xWKjkmtAQvorDv7rz8GXOgWhvmJTctPAl3MubBNfXa_Nkp2qpSB/pub?start=true&loop=true&delayms=10000'
      ];
      const dwell = 60000; // 60 seconds
      let idx = 0, win, holdMap = false, tikeeWin = null;

      // --- ONLY THE SCRIPT BELOW CHANGES ---
      document.getElementById('start').onclick = function(){
        // 1. Open Tikee in a new tab/window ONCE, ask you to click Control Room
        tikeeWin = window.open(tikeeUrl, '_blank');
        alert('On the Tikee tab, click "Control Room", then return here and click OK.');

        // 2. Open the regular rotator window (starts with Electra map)
        win = window.open(sites[0], '_blank');
        idx = 1; // next will be sites[1]
        this.disabled = true;
        this.textContent = 'Running…';

        // Wait double dwell for Electra map (same as before)
        const firstDelay = dwell * 2;

        setTimeout(() => {
          setInterval(() => {
            // CHANGE: Instead of reloading Tikee, just bring Tikee tab to front
            if (sites[idx] === tikeeUrl) {
              if (tikeeWin && !tikeeWin.closed) tikeeWin.focus();
            } else if (win && !win.closed) {
              win.location.href = sites[idx];
            }

            // UNCHANGED: Electra map stays twice as long
            if (sites[idx] === mapUrl && !holdMap) {
              holdMap = true; // Stay on map twice as long
            } else {
              holdMap = false;
              idx = (idx + 1) % sites.length;
            }
          }, dwell);
        }, firstDelay);
      };
      // --- END OF SCRIPT CHANGES ---
    })();
  </script>
</body>
</html>
